
<!doctype html>
<html>
<head>
  <meta charset="utf-8"><title>Withdrawals</title>

<link rel="icon" type="image/png" sizes="32x32" href="/images/cat.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/cat.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/cat.png">
<meta name="theme-color" content="#000000"></meta>
  
</head>
<body>
  <h1>Pending Withdrawals</h1>
  <div>
    <label>Admin</label>
    <input id="adminToken" style="width:60%" />
    <button id="btnLoad">Load</button>
  </div>
  <div id="list"></div>

<script>
const API_BASE = "/api";
document.getElementById("btnLoad").onclick = async () => {
  const token = document.getElementById("adminToken").value.trim();
  if (!token) return alert("Paste admin token");
  const res = await fetch(`${API_BASE}/admin/withdraws?status=pending`, { headers: { Authorization: "Bearer " + token }});
  const items = await res.json();
  const wrap = document.getElementById("list");
  wrap.innerHTML = "";
  items.forEach(it => {
    const div = document.createElement("div");
    div.style = "border:1px solid #ddd;padding:8px;margin:6px";
    div.innerHTML = `
      <b>${it.contact?.name || "No name"}</b> &nbsp; ${it.amountRequested} KES <br/>
      Email: ${it.contact?.email || ""} &nbsp; Phone: ${it.contact?.phone || ""} <br/>
      <small>${it.createdAt}</small><br/>
      <button data-id="${it._id}" class="approve">Approve</button>
      <button data-id="${it._id}" class="reject">Reject</button>
      <button data-id="${it._id}" class="paid">Mark Paid</button>
    `;
    wrap.appendChild(div);
  });

  
  wrap.querySelectorAll(".approve").forEach(b => b.onclick = async e => {
    const id = e.target.dataset.id;
    await fetch(`${API_BASE}/admin/withdraws/${id}/approve`, {
      method: "POST", headers: {"Authorization":"Bearer "+token}
    });
    alert("Approved");
    document.getElementById("btnLoad").click();
  });

  wrap.querySelectorAll(".reject").forEach(b => b.onclick = async e => {
    const id = e.target.dataset.id;
    const reason = prompt("Reason for rejection:");
    await fetch(`${API_BASE}/admin/withdraws/${id}/reject`, {
      method: "POST",
      headers: {"Authorization":"Bearer "+token, "Content-Type":"application/json"},
      body: JSON.stringify({ reason })
    });
    alert("Rejected");
    document.getElementById("btnLoad").click();
  });

  wrap.querySelectorAll(".paid").forEach(b => b.onclick = async e => {
    const id = e.target.dataset.id;
    const provider = prompt("Provider (e.g., Bank):");
    const ref = prompt("Provider reference:");
    await fetch(`${API_BASE}/admin/withdraws/${id}/paid`, {
      method: "POST",
      headers: {"Authorization":"Bearer "+token, "Content-Type":"application/json"},
      body: JSON.stringify({ provider, providerRef: ref })
    });
    alert("Marked paid");
    document.getElementById("btnLoad").click();
  });
};
</script>
</body>
</html>


